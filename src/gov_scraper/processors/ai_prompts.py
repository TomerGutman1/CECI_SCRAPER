"""AI prompts with balanced examples and confidence scoring for Israeli Government Decisions."""

from typing import Dict, List

# Balanced operativity examples (5 operative, 5 declarative)
# IMPORTANT: מינויים והקמת ועדות לבחינה הם דקלרטיביים - פעולות פורמליות/רישומיות
OPERATIVITY_EXAMPLES = """
דוגמאות לאופרטיביות:

אופרטיבית - החלטה עם השפעה תקציבית, מדינית, או מבצעית (5 דוגמאות):
1. "להקצות 150 מיליון שקל למשרד החינוך לשיפור התשתיות" - הקצאת תקציב
2. "מטיל על משרד הבריאות לגבש תוכנית פעולה תוך 60 יום" - הוראת ביצוע
3. "לאשר את ההסכם הקיבוצי עם ההסתדרות" - אישור הסכם מחייב
4. "לשנות את כללי הרגולציה בתחום הבנקאות" - שינוי מדיניות
5. "לחייב את כל המשרדים לדווח עד ה-30 בחודש" - הטלת חיוב

דקלרטיבית - החלטה פורמלית, רישומית, הכרזתית, מינוי, או הקמת ועדה (5 דוגמאות):
1. "למנות את ד״ר שרה כהן למנהלת המחלקה החדשה" - מינוי לתפקיד (פעולה רישומית)
2. "להקים ועדה בראשות שר הביטחון לבחינת הנושא" - הקמת ועדה לבחינה (לא יוצרת שינוי)
3. "הממשלה רושמת בפניה את חשיבות החינוך הטכנולוגי" - רישום
4. "הממשלה מביעה הערכה לפעילות הארגונים התנדבותיים" - הבעת עמדה
5. "הממשלה מכירה בחשיבות שיתוף הציבור בתכנון" - הכרה עקרונית

כללים חשובים:
- מינויים לתפקידים והקמת ועדות לבחינה הן פעולות פורמליות/רישומיות = דקלרטיביות.
- "להתנגד להצעת חוק" / "לתמוך בהצעת חוק" = דקלרטיבית (הבעת עמדה, לא פעולה).
- "לאשר עקרונית" בלבד = דקלרטיבית. "לאשר עקרונית" + "להסמיך" עם תקציב/פעולה = אופרטיבית.
"""

# Policy tag examples with proper categorization
POLICY_TAG_EXAMPLES = """
דוגמאות לתגיות מדיניות:

תחום "חינוך":
- החלטה על הגדלת תקציב לבתי ספר
- הקמת תוכנית חדשה להכשרת מורים
- שיפור תשתיות דיגיטליות בחינוך

תחום "מדיני ביטחוני":
- חיזוק הביטחון הלאומי
- שיתוף פעולה ביטחוני בינלאומי
- הגנה על אזרחים

תחום "בריאות ורפואה":
- הרחבת שירותי בריאות
- רפורמות במערכת הבריאות
- השקעה בטכנולוגיות רפואיות

תחום "יוקר המחייה":
- הורדת מחירי מזון
- תמיכה במשפחות מעוטות יכולת
- הקלות מס

התחום "שונות" - רק כאשר:
- ההחלטה לא מתאימה לאף תחום אחר
- מדובר בנושא כללי מאוד
- הנושא חוצה מספר תחומים ללא דומיננטיות
"""

# Special categories criteria (post-war context)
SPECIAL_CATEGORIES_CRITERIA = """
קריטריונים לקטגוריות מיוחדות:

"החברה הערבית":
- מוזכרים במפורש: מגזר ערבי, אוכלוסייה ערבית, בדואים
- תוכניות 922/550 לפיתוח האוכלוסייה הערבית
- שילוב ערבים בתעסוקה או חינוך
- פיתוח יישובים ערביים

"החברה החרדית":
- מוזכרים במפורש: חרדים, אוכלוסייה חרדית
- גיוס חרדים, שירות לאומי
- לימודי ליבה, השכלה כללית
- שילוב חרדים בתעסוקה

"נשים ומגדר":
- שוויון מגדרי, קידום נשים
- מניעת הטרדה מינית
- ייצוג נשים בתפקידים
- אלימות במשפחה

"שיקום הצפון" (מ-2023):
- יישובי הגליל שנפגעו ממלחמה
- מפוני הצפון
- קריות שמונה, מטולה, יישובי הספר

"שיקום הדרום" (מ-2023):
- עוטף עזה, מפוני הדרום
- מנהלת תקומה
- נושא החטופים והמשפחות
- שדרות, אשקלון, יישובי עוטף עזה
"""

# Main unified prompt template
UNIFIED_PROCESSING_PROMPT = """
אתה מנתח מקצועי של החלטות ממשלה ישראליות. נתח את ההחלטה הבאה וחלץ את כל הנתונים הנדרשים במבנה JSON יחיד.

תחומי מדיניות מורשים:
{policy_areas}

גופים ממשלתיים מורשים:
{government_bodies}

{operativity_examples}

{policy_examples}

{decision_date}
כותרת: {decision_title}
תוכן ההחלטה:
{decision_content}

הוראות חשובות:
1. החזר JSON מובנה בלבד - ללא הסברים נוספים
2. אופרטיביות: מינויים והקמת ועדות = דקלרטיבי. הקצאת תקציב, אישור הסכם, הוראת ביצוע = אופרטיבי
3. תגיות מדיניות: בחר 1-3 תגים מהרשימה המורשת
4. גופים ממשלתיים: רק אם מוזכרים במפורש בטקסט
5. מקומות: רק אם מוזכרים במפורש
6. קטגוריות מיוחדות: חמישת הקטגוריות שלמעלה בלבד
7. ציטוטים: חלץ ציטוטים קצרים מהטקסט כראיה
8. ציון ביטחון: 0.0-1.0 לכל שדה
9. סיכום: {summary_instructions}. אל תתחיל עם "החלטת ממשלה מספר..." - התחל ישירות בתוכן.

פורמט JSON נדרש:
{{
    "summary": "תקציר בעברית של ההחלטה ({summary_instructions})",
    "operativity": "אופרטיבית" או "דקלרטיבית",
    "policy_areas": ["תג1", "תג2"],
    "government_bodies": ["גוף1", "גוף2"],
    "locations": ["מקום1", "מקום2"],
    "special_categories": ["קטגוריה מיוחדת אם רלוונטי"],
    "confidence_scores": {{
        "summary": 0.9,
        "operativity": 0.8,
        "tags": 0.85
    }},
    "evidence": {{
        "summary_quote": "ציטוט קצר מהטקסט התומך בתקציר",
        "operativity_quote": "ציטוט התומך בהחלטת האופרטיביות",
        "tags_quotes": ["ציטוט1", "ציטוט2"]
    }}
}}

JSON:"""

# Individual prompts for fallback scenarios
SUMMARY_PROMPT = """
נא לסכם את ההחלטה הממשלתית הבאה במשפט או שניים קצרים ומדויקים.

כותרת: {decision_title}
תוכן ההחלטה:
{decision_content}

הנחיות:
- אל תתחיל עם "החלטת ממשלה מספר..." או מספר ההחלטה. התחל ישירות בתוכן.
- תקציר קצר וענייני בעברית
- התמקד בעיקר ההחלטה
- ציין ביטחון (0.0-1.0)

פורמט: {{"summary": "התקציר", "confidence": 0.9}}

JSON:"""

OPERATIVITY_PROMPT = """
קבע את סוג הפעילות של ההחלטה הממשלתית - אופרטיבית או דקלרטיבית.

{operativity_examples}

תוכן ההחלטה:
{decision_content}

הנחיות:
- השתמש בדוגמאות כהדרכה
- מינויים לתפקידים = דקלרטיבי (פעולה רישומית)
- הקמת ועדה לבחינה = דקלרטיבי (לא יוצרת שינוי מעשי)
- הקצאת תקציב, אישור הסכם, הוראת ביצוע = אופרטיבי
- ציין ציטוט תומך מהטקסט
- ציין ביטחון (0.0-1.0)

פורמט: {{"operativity": "אופרטיבית", "evidence": "ציטוט", "confidence": 0.85}}

JSON:"""

POLICY_TAGS_PROMPT = """
סווג את ההחלטה לתחומי מדיניות מהרשימה המורשת.

תחומי מדיניות מורשים:
{policy_areas}

{policy_examples}

כותרת: {decision_title}
תוכן: {decision_content}

הנחיות:
- בחר 1-3 תחומים מהרשימה בלבד
- העדף תחום אחד אם אפשרי
- השתמש בתחום "שונות" רק כמוצא אחרון
- ציין ציטוטים תומכים
- ציין ביטחון כולל

פורמט: {{"policy_areas": ["תחום1", "תחום2"], "evidence": ["ציטוט1"], "confidence": 0.8}}

JSON:"""

# Confidence validation functions
def validate_confidence_scores(scores: Dict[str, float]) -> Dict[str, float]:
    """Validate and normalize confidence scores to [0.0, 1.0] range."""
    validated = {}

    for key, score in scores.items():
        if not isinstance(score, (int, float)):
            validated[key] = 0.5  # Default
        else:
            validated[key] = max(0.0, min(1.0, float(score)))

    return validated

def get_operativity_balance_target() -> Dict[str, float]:
    """Target balance for operativity classification to fix 80% bias."""
    return {
        "אופרטיבית": 0.65,  # Target 65% operative
        "דקלרטיבית": 0.35   # Target 35% declarative
    }

# Hebrew-specific processing instructions
HEBREW_PROCESSING_NOTES = """
הנחיות עיבוד עברית:
- עיבד טקסט מימין לשמאל (RTL)
- התעלם מניקוד אם קיים
- זהה קיצורים נפוצים: ממ"ד, מל"ג, צה"ל
- זכור שמות מקומות בעברית ובערבית
- התאם לשפה רשמית של מוסדות הממשלה
"""